(function(b){function a(d,c){b.fn.mtDialog.open(ScriptURI+"?__mode="+d+"&amp;"+c)}tinymce.Editor.prototype.addMtButton=function(e,f){var d=this;var g={};var c=f.onclickFunctions;if(f.onclickFunctions){f.onclick=function(){var i=d.mtEditorStatus.mode;var h=c[i];if(typeof(h)=="string"){d.mtProxies[i].execCommand(h)}else{h.apply(d,arguments)}};for(k in c){g[k]=1}}else{g={wysiwyg:1,source:1}}if(!f.isSupported){f.isSupported=function(j,i){if(j=="wysiwyg"){return true}else{if(!g[j]){return false}}if(c){var h=c[d.mtEditorStatus.mode];if(typeof(h)=="string"){return d.mtProxies.source.isSupported(h)}else{return true}}else{return true}}}if(typeof(d.mtButtons)=="undefined"){d.mtButtons={}}d.mtButtons[e]=f;return d.addButton(e,f)};tinymce.ScriptLoader.add(tinymce.PluginManager.urls.mt+"/langs/en.js");tinymce.create("tinymce.plugins.MovableType",{init:function(j,c){tinymce.DOM.loadCSS(c+"/css/mt.css");var d=j.id;var h=b("#blog-id").val()||0;var i={};var e=[];var g={};function l(o,n){var m=o+"-"+n;if(!g[m]){g[m]={};b.each(j.mtButtons,function(p,q){if(q.isSupported(o,n)){g[m][p]=q}})}return g[m]}j.mtProxies=i;j.mtEditorStatus={mode:"wysiwyg",format:"richtext"};j.addCommand("mtGetStatus",function(){return j.mtEditorStatus});j.addCommand("mtSetStatus",function(m){var n=j.mtEditorStatus;b.extend(n,m);b.each(e,function(){j.controlManager.setDisabled(this,false)});e=[];if(n.mode=="source"){i.source.setFormat(n.format);var o={};b.each(l(n.mode,n.format),function(q,p){o[d+"_"+q]=1});b.each(j.controlManager.controls,function(p,q){if(!q.disabled&&!o[p]){j.controlManager.setDisabled(p,true);e.push(p)}})}});j.addCommand("mtGetProxies",function(){return i});j.addCommand("mtSetProxies",function(m){b.extend(i,m)});j.addMtButton("mt_font_size_smaller",{title:"mt.font_size_smaller",onclickFunctions:{wysiwyg:"fontSizeSmaller",source:"fontSizeSmaller"}});j.addMtButton("mt_font_size_larger",{title:"mt.font_size_larger",onclickFunctions:{wysiwyg:"fontSizeLarger",source:"fontSizeLarger"}});j.addMtButton("mt_bold",{title:"mt.bold",onclickFunctions:{wysiwyg:function(){j.execCommand("bold")},source:"bold"}});j.addMtButton("mt_italic",{title:"mt.italic",onclickFunctions:{wysiwyg:function(){j.execCommand("italic")},source:"italic"}});j.addMtButton("mt_underline",{title:"mt.underline",onclickFunctions:{wysiwyg:function(){j.execCommand("underline")},source:"underline"}});j.addMtButton("mt_strikethrough",{title:"mt.strikethrough",onclickFunctions:{wysiwyg:function(){j.execCommand("strikethrough")},source:"strikethrough"}});j.addMtButton("mt_insert_link",{title:"mt.insert_link",onclickFunctions:{wysiwyg:function(){var n=j.dom.getParent(j.selection.getNode(),"A");var m=!j.selection.isCollapsed();i.wysiwyg.execCommand("insertLink",null,{anchor:n,textSelected:m})},source:"insertLink",}});j.addMtButton("mt_insert_email",{title:"mt.insert_email",onclickFunctions:{wysiwyg:function(){var n=j.dom.getParent(j.selection.getNode(),"A");var m=!j.selection.isCollapsed();i.wysiwyg.execCommand("insertEmail",null,{anchor:n,textSelected:m})},source:"insertEmail",}});j.addMtButton("mt_indent",{title:"mt.indent",onclickFunctions:{wysiwyg:function(){j.execCommand("indent")},source:"indent"}});j.addMtButton("mt_outdent",{title:"mt.outdent",onclickFunctions:{wysiwyg:function(){j.execCommand("outdent")}}});j.addMtButton("mt_insert_unordered_list",{title:"mt.insert_unordered_list",onclickFunctions:{wysiwyg:function(){j.execCommand("insertUnorderedList")},source:"insertUnorderedList"}});j.addMtButton("mt_insert_ordered_list",{title:"mt.insert_ordered_list",onclickFunctions:{wysiwyg:function(){j.execCommand("insertOrderedList")},source:"insertOrderedList"}});j.addMtButton("mt_justify_left",{title:"mt.justify_left",onclickFunctions:{wysiwyg:function(){j.execCommand("justifyLeft")},source:"justifyLeft"}});j.addMtButton("mt_justify_center",{title:"mt.justify_center",onclickFunctions:{wysiwyg:function(){j.execCommand("justifyCenter")},source:"justifyCenter"}});j.addMtButton("mt_justify_right",{title:"mt.justify_right",onclickFunctions:{wysiwyg:function(){j.execCommand("justifyRight")},source:"justifyRight"}});j.addMtButton("mt_insert_image",{title:"mt.insert_image",onclick:function(){a("dialog_list_asset","_type=asset&amp;edit_field="+d+"&amp;blog_id="+h+"&amp;dialog_view=1&amp;filter=class&amp;filter_val=image")}});j.addMtButton("mt_insert_file",{title:"mt.insert_file",onclick:function(){a("dialog_list_asset","_type=asset&amp;edit_field="+d+"&amp;blog_id="+h+"&amp;dialog_view=1")}});j.addMtButton("mt_source_mode",{title:"mt.source_mode",onclickFunctions:{wysiwyg:function(){j.execCommand("mtSetFormat","none.tinymce_temp")},source:function(){j.execCommand("mtSetFormat","richtext")}}});var f={mt_bold:"bold",mt_italic:"italic",mt_underline:"underline",mt_strikethrough:"strikethrough",mt_justify_left:"justifyleft",mt_justify_center:"justifycenter",mt_justify_right:"justifyright"};j.onNodeChange.add(function(p,m,v,u,o){var r=p.mtEditorStatus;if(r.mode=="wysiwyg"){b.each(f,function(s,n){m.setActive(s,p.queryCommandState(n))});m.setDisabled("mt_outdent",!p.queryCommandState("Outdent"))}if(p.getParam("fullscreen_is_enabled")){m.setDisabled("mt_source_mode",true)}else{var q=p.mtEditorStatus.mode=="source"&&p.mtEditorStatus.format!="none.tinymce_temp";m.setDisabled("mt_source_mode",q);var t=p.mtEditorStatus.mode=="source"&&p.mtEditorStatus.format=="none.tinymce_temp";m.setActive("mt_source_mode",t)}})},getInfo:function(){return{longname:"MovableType",author:"Six Apart, Ltd",authorurl:"",infourl:"",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("mt",tinymce.plugins.MovableType)})(jQuery);